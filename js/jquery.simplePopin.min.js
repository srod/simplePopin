/* simplePopin - jQuery plugin
 * 
 * This plugin is used to show popins on a web page.
 * 
 * How to use:
 *
 * jQuery(".links").simplePopin({
 *     type: "inline", // iframe, inline, image
 *     width: 300,
 *     height: 300
 * });
 * 
 * Developed with jQuery version: 1.4.3
 * 
 * Version: 0.1
 * Name: simplePopin
 * 
 * Author: Rodolphe Stoclin
 * E-mail: rodolphe@2clics.net
 * Web: http://www.2clics.net
 */

(function(a){a.fn.simplePopin=function(e){var b={init:function(f){var g={type:"inline",width:500,height:300,opacity:0.5,imageLoader:"img/loadingAnimation.gif"};c.settings=a.extend(g,f);c.createOverlay();c.createPopin();c.createLoader();c.bindClose();return this.each(function(){c.run(this)})},show:function(){c.showOverlay();c.showPopin();c.hideLoader()},hide:function(){c.hideOverlay();c.hidePopin();c.hideLoader()},destroy:function(){a("#SP-Overlay").unbind("click.simplePopin");a("#SP-Popin .close-popin").die("click.simplePopin");a(window).unbind("resize.simplePopin");c.destroyOverlay();c.destroyPopin();c.destroyLoader()},reposition:function(){c.center("#SP-Popin",c.settings.width,c.settings.height)},update:function(f){c.updateContent(f)}};var c={};c.settings={};c.createOverlay=function(){if(!a("#SP-Overlay").length){a("<div></div>").appendTo("body").attr({id:"SP-Overlay"}).css("opacity",this.settings.opacity);a("#SP-Overlay").bind("click.simplePopin",function(){b.hide()});if(d.isIE6()){var g=(d.windowHeight()>a("body").height())?d.windowHeight():a("body").height();var f=a("body").width();a("#SP-Overlay").css({position:"absolute",height:g+"px",width:f+"px"})}}};c.destroyOverlay=function(){a("#SP-Overlay").remove()};c.showOverlay=function(){a("#SP-Overlay").fadeIn()};c.hideOverlay=function(){a("#SP-Overlay").fadeOut()};c.createLoader=function(){if(!a("#SP-Loader").length){a("<div></div>").appendTo("body").attr({id:"SP-Loader"});var f=new Image();f.onload=function(){f.onload=null;c.settings.imageLoaderWidth=f.width;c.settings.imageLoaderHeight=f.height;a("<img />").appendTo("#SP-Loader").attr({src:c.settings.imageLoader});c.fixLoader()};f.src=this.settings.imageLoader}};c.destroyLoader=function(){a("#SP-Loader").remove()};c.showLoader=function(){c.fixLoader();a("#SP-Loader").fadeIn()};c.hideLoader=function(){a("#SP-Loader").fadeOut()};c.fixLoader=function(){a("#SP-Loader").css({width:c.settings.imageLoaderWidth+"px",height:c.settings.imageLoaderHeight+"px"});this.center("#SP-Loader",c.settings.imageLoaderWidth,c.settings.imageLoaderHeight)};c.createPopin=function(){if(!a("#SP-Popin").length){a("<div></div>").appendTo("body").attr({id:"SP-Popin"})}};c.destroyPopin=function(){a("#SP-Popin").remove()};c.showPopin=function(){c.fixPopin();a("#SP-Popin").fadeIn()};c.hidePopin=function(){a("#SP-Popin").fadeOut(function(){a(this).empty()})};c.fixPopin=function(){a("#SP-Popin").css({width:this.settings.width+"px",height:this.settings.height+"px"});this.center("#SP-Popin",this.settings.width,this.settings.height)};c.center=function(g,h,f){if((f>d.windowHeight())&&(h>d.windowWidth())){a(g).css("left",0);a(g).css("top",0)}else{if(f>d.windowHeight()){a(g).css("left",Math.round(d.windowWidth()/2)-Math.round(h/2));a(g).css("top",0)}else{if(h>d.windowWidth()){a(g).css("left",0);a(g).css("top",Math.round(d.windowHeight()/2)-Math.round(f/2))}else{a(g).css("left",Math.round(d.windowWidth()/2)-Math.round(h/2));a(g).css("top",Math.round(d.windowHeight()/2)-Math.round(f/2))}}}};c.createIframeContent=function(){c.showLoader();c.fixPopin();a('<iframe src="'+this.settings.url+'" frameborder="0" hspace="0" onload="javascript:jQuery().simplePopin(\'show\');"></iframe>').appendTo("#SP-Popin").attr({id:"SP-Iframe",name:"SP-Iframe"}).css({width:this.settings.width+"px",height:this.settings.height+"px"})};c.createInlineContent=function(){a("#SP-Popin").html(a("#"+this.settings.url.split("#")[1]).html())};c.createImageContent=function(){c.showLoader();var f=new Image();f.onload=function(){f.onload=null;var g=d.resizeImage(f);c.settings.width=g[0];c.settings.height=g[1];a("<img />").appendTo("#SP-Popin").attr({src:c.settings.url,width:c.settings.width,height:c.settings.height});b.show()};f.src=this.settings.url};c.bindClose=function(){a("#SP-Popin .close-popin").unbind("click.simplePopin").live("click.simplePopin",function(f){f.preventDefault();b.hide()});document.onkeyup=function(g){var f=event.keyCode||g.which;if(f==27){b.hide()}}};c.bindResize=function(){a(window).unbind("resize.simplePopin").bind("resize.simplePopin",function(){c.center("#SP-Popin",c.settings.width,c.settings.height)})};c.updateContent=function(f){a("#SP-Popin").html(f)};c.run=function(f){var g=a(f);c.settings.url=f.href;g.click(function(h){h.preventDefault();c.bindResize();switch(c.settings.type){case"iframe":c.createIframeContent();break;case"inline":c.createInlineContent();b.show();break;case"image":c.createImageContent();break}c.showOverlay()})};var d={};d.windowHeight=function(){return a(window).height()};d.windowWidth=function(){return a(window).width()};d.resizeImage=function(i){var g=d.windowWidth()-50;var j=d.windowHeight()-50;var h=i.width;var f=i.height;if(h>g){f=f*(g/h);h=g;if(f>j){h=h*(j/f);f=j}}else{if(f>j){h=h*(j/f);f=j;if(h>g){f=f*(g/h);h=g}}}return[h,f]};d.isIE6=function(){return(a.browser.msie&&a.browser.version==6)?true:false};if(b[e]){return b[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return b.init.apply(this,arguments)}else{a.error("Method "+e+" does not exist on jQuery.simplePopin")}}}})(jQuery);